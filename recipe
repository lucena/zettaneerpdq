#
# Recipe for Aerohive VM/Disk Creation
#

# First create a 200GB data disk.
gcutil --project=zettaneerpdq adddisk aerodata01 --zone=us-central1-f --size_gb=200 

# Then create a VM using the CentOS image and also attaches to the data disk
gcutil --project=zettaneerpdq addinstance aerovm01 --zone=us-central1-f --disk=aerodata01 --machine_type=n1-standard-1 --image=centos-6

# Connect to the vm
gcutil --project=zettaneerpdq ssh aerovm01


# Once on the VM, Find the disk:
ls -l /dev/disk/by-id/google-*

# create the mount point
sudo mkdir /mount
sudo mkdir /mount/aerodata01

# mount the disk and give everyone permissions to it.
sudo /usr/share/google/safe_format_and_mount -m "mkfs.ext4 -F" /dev/sdb /mount/aerodata01
sudo chmod a+w /mount/aerodata01

# verify it is there
df -h

# Add some data
sudo mkdir /mount/aerodata01/data
sudo chmod 777 /mount/aerodata01/data
touch /mount/aerodata01/data/hello.txt

# Unmount it
sudo umount /dev/disk/by-id/google-aerodata01

# Detach it
gcutil --project=zettaneerpdq detachdisk --zone=us-central1-f --device_name=aerodata01 aerovm01




